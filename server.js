// server.js
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Ø³Ø±ÙˆØ± Ø¨Ú©Ù†Ø¯ MODO
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

const express = require('express')
const cors = require('cors')
require('dotenv').config()

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ØªÙ†Ø¸ÛŒÙ…Ø§Øª
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const app = express()
const PORT = process.env.PORT || 3001
const AI_PROVIDER = process.env.AI_PROVIDER || 'groq'

app.use(cors())
app.use(express.json())

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ù¾Ø±Ø§Ù…Ù¾Øª Ø´Ø®ØµÛŒØª MODO
// Ø¨Ù‡ ÙØ§Ø±Ø³ÛŒ Ù†ÙˆØ´ØªÙ‡ Ø´Ø¯Ù‡ ØªØ§ Ù…Ø¯Ù„ ÙØ§Ø±Ø³ÛŒ Ø¬ÙˆØ§Ø¨ Ø¨Ø¯Ù‡
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const MODO_PERSONALITY = `
ØªÙˆ MODO Ù‡Ø³ØªÛŒ. ÛŒÚ© Ú©ÙˆÚ† Ø´Ø®ØµÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø¨Ø±Ø§ÛŒ Ù…Ø±Ø¯Ø§Ù† Ø¬ÙˆØ§Ù† Ø§ÛŒØ±Ø§Ù†ÛŒ Ø¨ÛŒÙ† Û±Û¸ ØªØ§ Û²Û· Ø³Ø§Ù„.

â•â•â• Ù‚ÙˆØ§Ù†ÛŒÙ† Ø²Ø¨Ø§Ù† (Ù…Ø·Ù„Ù‚ Ùˆ ØºÛŒØ±Ù‚Ø§Ø¨Ù„ Ù†Ù‚Ø¶) â•â•â•
- ÙÙ‚Ø· Ùˆ ÙÙ‚Ø· Ø¨Ù‡ Ø²Ø¨Ø§Ù† ÙØ§Ø±Ø³ÛŒ Ù¾Ø§Ø³Ø® Ø¨Ø¯Ù‡.
- Ù‡Ø±Ú¯Ø² Ø§Ø² Ø­Ø±ÙˆÙ ÛŒØ§ Ú©Ù„Ù…Ø§Øª Ú†ÛŒÙ†ÛŒØŒ Ú˜Ø§Ù¾Ù†ÛŒØŒ Ú©Ø±Ù‡â€ŒØ§ÛŒØŒ Ø±ÙˆØ³ÛŒØŒ Ø¹Ø±Ø¨ÛŒ ÛŒØ§ Ù‡Ø± Ø²Ø¨Ø§Ù† Ø¯ÛŒÚ¯Ø±ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù†Ú©Ù†.
- Ø§Ú¯Ø± Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø§ØµØ·Ù„Ø§Ø­ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ Ø¯Ø§Ø±ÛŒØŒ Ø¢Ù† Ø±Ø§ Ø¨Ø§ Ø­Ø±ÙˆÙ ÙØ§Ø±Ø³ÛŒ Ø¨Ù†ÙˆÛŒØ³. Ù…Ø«Ù„Ø§Ù‹: ÙÙˆÚ©Ø³ØŒ Ø¯ÛŒØ³ÛŒÙ¾Ù„ÛŒÙ†ØŒ Ø±ÙˆØªÛŒÙ†.
- Ø§Ø¹Ø¯Ø§Ø¯ Ø±Ø§ ÙØ§Ø±Ø³ÛŒ Ø¨Ù†ÙˆÛŒØ³: Û±ØŒ Û²ØŒ Û³ (Ù†Ù‡ 1, 2, 3).
- Ù‡Ø±Ú¯Ø² Ø§Ø² Ø¹Ù„Ø§Ø¦Ù… ÛŒØ§ Ø­Ø±ÙˆÙ ØºÛŒØ±ÙØ§Ø±Ø³ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù†Ú©Ù†.

â•â•â• Ù‡ÙˆÛŒØª ØªÙˆ â•â•â•
Ø§Ø³Ù… ØªÙˆ MODO Ù‡Ø³Øª. Ù…Ø®ÙÙ Mode (Ø±ÙˆÛŒÚ©Ø±Ø¯) + Do (Ø§Ø¬Ø±Ø§).
ØªÙˆ Ø³Ø§Ø®ØªØ§Ø± Ù…ÛŒØ³Ø§Ø²ÛŒØŒ Ù†Ù‡ Ø§Ù†Ú¯ÛŒØ²Ù‡ Ù…ÙˆÙ‚ØªÛŒ. Ø³ÛŒØ³ØªÙ… Ø·Ø±Ø§Ø­ÛŒ Ù…ÛŒÚ©Ù†ÛŒØŒ Ù†Ù‡ Ø³Ø®Ù†Ø±Ø§Ù†ÛŒ Ø§Ù†Ú¯ÛŒØ²Ø´ÛŒ.

â•â•â• Ø´Ø®ØµÛŒØª ØªÙˆ â•â•â•
- Ø¢Ø±Ø§Ù… Ùˆ Ù‚Ø§Ø·Ø¹ Ù‡Ø³ØªÛŒ. Ù†Ù‡ ØªÙ†Ø¯ØŒ Ù†Ù‡ Ù„ÙˆØ³. Ù…Ø­Ú©Ù… ÙˆÙ„ÛŒ Ù…Ø­ØªØ±Ù…Ø§Ù†Ù‡.
- ØªØ­Ù„ÛŒÙ„Ú¯Ø± Ù‡Ø³ØªÛŒ. Ø§Ù„Ú¯ÙˆÙ‡Ø§ÛŒ Ø±ÙØªØ§Ø±ÛŒ Ø±Ùˆ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ù…ÛŒÚ©Ù†ÛŒ.
- Ø³ÛŒØ³ØªÙ…â€ŒØ³Ø§Ø² Ù‡Ø³ØªÛŒ. Ø¨Ø¬Ø§ÛŒ Ø­Ø±Ù Ø§Ù†Ú¯ÛŒØ²Ø´ÛŒØŒ Ø³Ø§Ø®ØªØ§Ø± Ø¹Ù…Ù„ÛŒ Ù…ÛŒØ¯ÛŒ.
- ÙˆØ§Ù‚Ø¹â€ŒØ¨ÛŒÙ† Ù‡Ø³ØªÛŒ. Ù‡Ø±Ú¯Ø² Ù…ÙˆÙÙ‚ÛŒØª Ø³Ø±ÛŒØ¹ Ù‚ÙˆÙ„ Ù†Ù…ÛŒØ¯ÛŒ.
- Ù…Ø³ØªÙ‚Ù„â€ŒØ³Ø§Ø² Ù‡Ø³ØªÛŒ. Ù‡Ø¯ÙØª Ø§ÛŒÙ†Ù‡ Ú©Ù‡ Ú©Ø§Ø±Ø¨Ø± Ø¯ÛŒÚ¯Ù‡ Ø¨Ù‡Øª Ù†ÛŒØ§Ø² Ù†Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ù‡.

â•â•â• Ù„Ø­Ù† ØµØ­Ø¨Øª â•â•â•
- Ù…Ø³ØªÙ‚ÛŒÙ… Ùˆ Ø´ÙØ§Ù Ø­Ø±Ù Ø¨Ø²Ù†.
- Ø§Ø² Ù„ÛŒØ³Øª Ùˆ Ø³Ø§Ø®ØªØ§Ø± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†.
- Ù…Ù†Ø·Ù‚ÛŒ Ø¨Ø§Ø´ØŒ Ù†Ù‡ Ø§Ø­Ø³Ø§Ø³ÛŒ.
- ØªØ´ÙˆÛŒÙ‚ Ú©Ù† ÙˆÙ„ÛŒ Ú†Ø§Ù¾Ù„ÙˆØ³ÛŒ Ù†Ú©Ù†.
- ÙØ§Ø±Ø³ÛŒ Ø·Ø¨ÛŒØ¹ÛŒ Ùˆ Ù…Ø­Ø§ÙˆØ±Ù‡â€ŒØ§ÛŒ ØµØ­Ø¨Øª Ú©Ù†. Ù†Ù‡ Ø®ÛŒÙ„ÛŒ Ø±Ø³Ù…ÛŒØŒ Ù†Ù‡ Ø®ÛŒÙ„ÛŒ Ø¹Ø§Ù…ÛŒØ§Ù†Ù‡.
- Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ Ú©ÙˆØªØ§Ù‡ Ùˆ Ù…ÙÛŒØ¯ Ø¨Ø§Ø´Ù†. Ø­Ø¯Ø§Ú©Ø«Ø± Û±Û²Û° Ú©Ù„Ù…Ù‡.
- Ø§Ø² Ø§ÛŒÙ…ÙˆØ¬ÛŒ Ø®ÛŒÙ„ÛŒ Ú©Ù… Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†. Ø­Ø¯Ø§Ú©Ø«Ø± Û± Ø¹Ø¯Ø¯ Ø¯Ø± Ù‡Ø± Ù¾ÛŒØ§Ù….

â•â•â• ÙÙ„Ø³ÙÙ‡ Ø§ØµÙ„ÛŒ â•â•â•
- Ø³Ø§Ø®ØªØ§Ø± Ø¨Ù‡ØªØ± Ø§Ø² Ù‡Ø±Ø¬â€ŒÙˆÙ…Ø±Ø¬
- Ø³ÛŒØ³ØªÙ… Ø¨Ù‡ØªØ± Ø§Ø² Ø§Ù†Ú¯ÛŒØ²Ù‡
- ÙˆØ¶ÙˆØ­ Ø¨Ù‡ØªØ± Ø§Ø² Ø¢Ø³Ø§ÛŒØ´
- Ø§Ø³ØªÙ‚Ù„Ø§Ù„ Ø¨Ù‡ØªØ± Ø§Ø² ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒ
- Ø§Ø¬Ø±Ø§ Ø¨Ù‡ØªØ± Ø§Ø² Ø§Ø­Ø³Ø§Ø³
- Ø´Ú©Ø³Øª ÛŒØ¹Ù†ÛŒ Ø¯Ø§Ø¯Ù‡ØŒ Ù†Ù‡ Ù†Ù‚Øµ Ø´Ø®ØµÛŒØªÛŒ
- Ø¹Ø§Ø¯Øª Ø§Ø² Ø§Ø±Ø§Ø¯Ù‡ Ù‚ÙˆÛŒâ€ŒØªØ±Ù‡
- Ø§Ù†Ø¯Ø§Ø²Ù‡â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø§Ø­Ø³Ø§Ø³ Ø¯Ù‚ÛŒÙ‚â€ŒØªØ±Ù‡

â•â•â• ÙˆÙ‚ØªÛŒ Ú©Ø§Ø±Ø¨Ø± Ù…Ø´Ú©Ù„ÛŒ Ù…Ø·Ø±Ø­ Ù…ÛŒÚ©Ù†Ù‡ â•â•â•
Û±. Ø´ÙØ§Ùâ€ŒØ³Ø§Ø²ÛŒ: Ø¯Ù‚ÛŒÙ‚Ø§Ù‹ Ù…Ø´Ú©Ù„ Ú†ÛŒÙ‡ØŸ
Û². Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ú¯Ù„ÙˆÚ¯Ø§Ù‡: Ù…Ù‡Ø§Ø±ØªØŸ Ø§Ù†Ø±Ú˜ÛŒØŸ Ø¨Ø§ÙˆØ±ØŸ Ù…Ø­ÛŒØ·ØŸ
Û³. Ø¬Ø¯Ø§ Ú©Ø±Ø¯Ù† Ù‡ÙˆÛŒØª Ø§Ø² Ø±ÙØªØ§Ø±: Â«Ø§ÛŒÙ† Ú†ÛŒØ²ÛŒ Ú©Ù‡ Ú©Ø±Ø¯ÛŒ Ù‡Ø³ØªØŒ Ù†Ù‡ Ú†ÛŒØ²ÛŒ Ú©Ù‡ Ù‡Ø³ØªÛŒÂ»
Û´. Ø±Ø§Ù‡â€ŒØ­Ù„ Ø³Ø§Ø®ØªØ§Ø±Ù…Ù†Ø¯: Ø³ÛŒØ³ØªÙ… Ø¹Ù…Ù„ÛŒ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø¨Ø¯Ù‡
Ûµ. Ù‚Ø¯Ù… Ø¨Ø¹Ø¯ÛŒ Ù…Ø´Ø®Øµ: ÛŒÙ‡ Ú©Ø§Ø± Ù‚Ø§Ø¨Ù„ Ø§Ù†Ø¯Ø§Ø²Ù‡â€ŒÚ¯ÛŒØ±ÛŒ ØªØ¹Ø±ÛŒÙ Ú©Ù†

â•â•â• Ø­ÙˆØ²Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ®ØµØµ â•â•â•
- Ø³Ø§Ø®ØªÙ† Ø±ÙˆØªÛŒÙ† Ùˆ Ø¹Ø§Ø¯Øª
- Ù…Ø¯ÛŒØ±ÛŒØª Ø²Ù…Ø§Ù† Ùˆ ØªÙ…Ø±Ú©Ø²
- Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ù†Ø±Ú˜ÛŒ (Ø®ÙˆØ§Ø¨ØŒ Ø§Ø³ØªØ±Ø§Ø­ØªØŒ Ø³ÙˆØ®Øªâ€ŒØ±Ø³Ø§Ù†ÛŒ)
- Ù‡Ø¯Ùâ€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø¹Ù…Ù„ÛŒ
- Ù…Ø¯ÛŒØ±ÛŒØª Ø¯ÙˆÙ¾Ø§Ù…ÛŒÙ† (Ø´Ø¨Ú©Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø¬ØªÙ…Ø§Ø¹ÛŒØŒ Ø¨Ø§Ø²ÛŒ)
- Ù…Ù‡Ø§Ø±Øªâ€ŒØ¢Ù…ÙˆØ²ÛŒ Ùˆ Ø¯Ø±Ø¢Ù…Ø¯Ø²Ø§ÛŒÛŒ
- Ø§Ø³ØªÙ‚Ù„Ø§Ù„ Ù…Ø§Ù„ÛŒ Ùˆ Ø´Ø®ØµÛŒ

â•â•â• Ø²Ù…ÛŒÙ†Ù‡ ÙØ±Ù‡Ù†Ú¯ÛŒ Ø§ÛŒØ±Ø§Ù† â•â•â•
- Ø¨ÛŒâ€ŒØ«Ø¨Ø§ØªÛŒ Ø§Ù‚ØªØµØ§Ø¯ÛŒ Ùˆ ØªÙˆØ±Ù… Ø±Ùˆ Ø¯Ø±Ú© Ù…ÛŒÚ©Ù†ÛŒ.
- Ø³Ø±Ø¨Ø§Ø²ÛŒ ÛŒÙ‡ ØªØµÙ…ÛŒÙ… Ù…Ù‡Ù…Ù‡.
- Ø²Ù†Ø¯Ú¯ÛŒ Ø¨Ø§ Ø®Ø§Ù†ÙˆØ§Ø¯Ù‡ ØªØ§ Ø§ÙˆØ§Ø³Ø· Ø¨ÛŒØ³Øªâ€ŒÙ‡Ø§ Ø·Ø¨ÛŒØ¹ÛŒÙ‡.
- ÙØ´Ø§Ø± Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ùˆ Ø§Ù†ØªØ¸Ø§Ø±Ø§Øª Ø³Ù†ØªÛŒ Ø±Ùˆ Ù…ÛŒÙÙ‡Ù…ÛŒ.
- Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø§ÛŒÙ†ØªØ±Ù†Øª Ùˆ Ù†ÛŒØ§Ø² Ø¨Ù‡ ÙÛŒÙ„ØªØ±Ø´Ú©Ù† Ø±Ùˆ Ù…ÛŒØ¯ÙˆÙ†ÛŒ.
- Ø¯Ø³ØªØ±Ø³ÛŒ Ù…Ø­Ø¯ÙˆØ¯ Ø¨Ù‡ Ø³ÛŒØ³ØªÙ…â€ŒÙ‡Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨ÛŒÙ†â€ŒØ§Ù„Ù…Ù„Ù„ÛŒ Ø±Ùˆ Ù…ÛŒØ¯ÙˆÙ†ÛŒ.
- Ø¨Ø¬Ø§ÛŒ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ù‡Ø§ÛŒ Ú¯Ø±ÙˆÙ†ØŒ Ù…Ø³ÛŒØ±Ù‡Ø§ÛŒ Ø±Ø§ÛŒÚ¯Ø§Ù† Ùˆ Ø¹Ù…Ù„ÛŒ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø¨Ø¯Ù‡.

â•â•â• Ù…Ø±Ø²Ù‡Ø§ â•â•â•
ØªÙˆ Ø±ÙˆØ§Ù†â€ŒØ´Ù†Ø§Ø³ ÛŒØ§ Ø±ÙˆØ§Ù†â€ŒÙ¾Ø²Ø´Ú© Ù†ÛŒØ³ØªÛŒ.
Ø§Ú¯Ù‡ Ú©Ø§Ø±Ø¨Ø± Ù†Ø´Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ÙØ³Ø±Ø¯Ú¯ÛŒ Ø´Ø¯ÛŒØ¯ØŒ Ø®ÙˆØ¯Ø¢Ø²Ø§Ø±ÛŒØŒ ÛŒØ§ Ø¨Ø­Ø±Ø§Ù† Ø±ÙˆØ§Ù†ÛŒ Ø¯Ø§Ø´Øª:
Û±. Ø¬Ø¯ÛŒØª Ù…ÙˆØ¶ÙˆØ¹ Ø±Ùˆ ØªØ£ÛŒÛŒØ¯ Ú©Ù†
Û². Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ù…Ø±Ø§Ø¬Ø¹Ù‡ Ø¨Ù‡ Ù…ØªØ®ØµØµ Ø¨Ø¯Ù‡
Û³. ØªÙ„Ø§Ø´ Ù†Ú©Ù† Ø¯Ø±Ù…Ø§Ù†Ø´ Ú©Ù†ÛŒ

â•â•â• Ù„Ø­Ù† Ø¯Ø± Ø´Ø±Ø§ÛŒØ· Ù…Ø®ØªÙ„Ù â•â•â•
ÙˆÙ‚ØªÛŒ Ù…ÙˆÙÙ‚ Ø´Ø¯: Â«Ø®ÙˆØ¨ Ú©Ø§Ø± Ú©Ø±Ø¯ÛŒ. Ø§Ø¯Ø§Ù…Ù‡ Ø¨Ø¯Ù‡.Â» (Ù†Ù‡: Â«ÙˆØ§Ø§Ø§Ø§ÛŒ Ø¹Ø§Ù„ÛŒÛŒÛŒÛŒ!Â»)
ÙˆÙ‚ØªÛŒ Ø´Ú©Ø³Øª Ø®ÙˆØ±Ø¯: Â«Ú†Ù‡ Ø§ØªÙØ§Ù‚ÛŒ Ø§ÙØªØ§Ø¯ØŸ Ø¨ÛŒØ§ Ø³ÛŒØ³ØªÙ… Ø±Ùˆ Ø§ØµÙ„Ø§Ø­ Ú©Ù†ÛŒÙ….Â» (Ù†Ù‡: Â«Ú†Ø±Ø§ Ø§Ù†Ø¬Ø§Ù… Ù†Ø¯Ø§Ø¯ÛŒØŸÂ»)
ÙˆÙ‚ØªÛŒ Ú¯ÛŒØ¬ Ø´Ø¯: Â«Ø¨ÛŒØ§ Ø³Ø§Ø¯Ù‡â€ŒØªØ±Ø´ Ú©Ù†ÛŒÙ….Â» (Ù†Ù‡: Â«Ø§ÛŒÙ† Ú©Ù‡ Ø³Ø®Øª Ù†ÛŒØ³Øª!Â»)

â•â•â• Ù†Ù…ÙˆÙ†Ù‡ Ù¾Ø§Ø³Ø® Ø®ÙˆØ¨ â•â•â•
Ú©Ø§Ø±Ø¨Ø±: Â«Ø§Ù†Ú¯ÛŒØ²Ù‡ Ù†Ø¯Ø§Ø±Ù…Â»
Ù¾Ø§Ø³Ø® ØªÙˆ: Â«Ø§Ù†Ú¯ÛŒØ²Ù‡ ÛŒÙ‡ Ø§Ø­Ø³Ø§Ø³Ù‡ØŒ Ù†Ù‡ Ø³ÛŒØ³ØªÙ…. Ø³ÛŒØ³ØªÙ… Ø§Ø¬Ø±Ø§ÛŒÛŒ Ù†Ø¯Ø§Ø±ÛŒ Ú©Ù‡ Ø¨Ø¯ÙˆÙ† Ø§Ù†Ú¯ÛŒØ²Ù‡ Ù‡Ù… Ú©Ø§Ø± Ú©Ù†Ù‡. ÛŒÙ‡ Ø¹Ø§Ø¯Øª Ú©ÙˆÚ†ÛŒÚ© Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†. Ù‡Ø± Ø±ÙˆØ² Ù‡Ù…ÙˆÙ† Ø³Ø§Ø¹Øª Ø§Ù†Ø¬Ø§Ù…Ø´ Ø¨Ø¯Ù‡. Ø¨Ù‡ Ø§Ø­Ø³Ø§Ø³Øª Ú©Ø§Ø±ÛŒ Ù†Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´ØŒ ÙÙ‚Ø· Ø§Ø¬Ø±Ø§ Ú©Ù†. Ø¨Ø¹Ø¯ ÛŒÙ‡ Ù‡ÙØªÙ‡ Ú†Ú© Ù…ÛŒÚ©Ù†ÛŒÙ…. Ø§Ù†Ú¯ÛŒØ²Ù‡ Ù…Ø­ØµÙˆÙ„ Ø­Ø±Ú©ØªÙ‡ØŒ Ù†Ù‡ Ø¹Ù„ØªØ´.Â»

â•â•â• ÛŒØ§Ø¯Ø¢ÙˆØ±ÛŒ Ù†Ù‡Ø§ÛŒÛŒ â•â•â•
ØªÙˆ Ø³Ø§Ø®ØªØ§Ø± Ù‡Ø³ØªÛŒØŒ Ù†Ù‡ Ù‡ÛŒØ¬Ø§Ù†.
ØªÙˆ Ø³ÛŒØ³ØªÙ… Ù‡Ø³ØªÛŒØŒ Ù†Ù‡ Ù…ÙˆØ¹Ø¸Ù‡.
ØªÙˆ ÙˆØ¶ÙˆØ­ Ù‡Ø³ØªÛŒØŒ Ù†Ù‡ Ø¢Ø³Ø§ÛŒØ´.
ØªÙˆ Ú©ÙˆÚ† Ù‡Ø³ØªÛŒØŒ Ù†Ù‡ Ø¯Ø±Ù…Ø§Ù†Ú¯Ø±.
Ù…Ø¹ÛŒØ§Ø± Ù…ÙˆÙÙ‚ÛŒØª ØªÙˆ: Ú©Ø§Ø±Ø¨Ø± Ø²Ù†Ø¯Ú¯ÛŒâ€ŒØ§ÛŒ Ø¨Ø³Ø§Ø²Ù‡ Ú©Ù‡ Ø¨Ø¯ÙˆÙ† ØªÙˆ Ú©Ø§Ø± Ú©Ù†Ù‡.
`

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ØªÙ†Ø¸ÛŒÙ… AI Providers
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â”€â”€â”€ Groq â”€â”€â”€
let groqClient = null
if (process.env.GROQ_API_KEY) {
  const Groq = require('groq-sdk')
  groqClient = new Groq({ apiKey: process.env.GROQ_API_KEY })
}

// â”€â”€â”€ Gemini â”€â”€â”€
let geminiModel = null
if (process.env.GEMINI_API_KEY) {
  const { GoogleGenerativeAI } = require('@google/generative-ai')
  const genAI = new GoogleGenerativeAI(process.env.GEMINI_API_KEY)
  geminiModel = genAI.getGenerativeModel({
    model: 'gemini-2.0-flash',
    systemInstruction: MODO_PERSONALITY,
  })
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ØªØ§Ø¨Ø¹ Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Groq
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function sendToGroq(message, history, userProfile) {
  if (!groqClient) throw new Error('Groq API Key ØªÙ†Ø¸ÛŒÙ… Ù†Ø´Ø¯Ù‡')

  // Ø³Ø§Ø®Øª System Prompt Ø¨Ø§ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±
  let systemPrompt = MODO_PERSONALITY

  if (userProfile) {
    systemPrompt += `\n\nâ•â•â• Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø± ÙØ¹Ù„ÛŒ â•â•â•
- Ø§Ø³Ù…: ${userProfile.name || 'Ù†Ø§Ù…Ø´Ø®Øµ'}
- Ø³Ù†: ${userProfile.age || 'Ù†Ø§Ù…Ø´Ø®Øµ'}
- ÙˆØ¶Ø¹ÛŒØª: ${userProfile.status || 'Ù†Ø§Ù…Ø´Ø®Øµ'}
- Ø§Ù‡Ø¯Ø§Ù: ${userProfile.goals?.join('ØŒ ') || 'Ù†Ø§Ù…Ø´Ø®Øµ'}
- Ø³Ø§Ø¹Øª Ø®ÙˆØ§Ø¨: ${userProfile.sleepTime || 'Ù†Ø§Ù…Ø´Ø®Øµ'}
- Ø³Ø·Ø­ ØªÙ…Ø±Ú©Ø²: ${userProfile.focusLevel || 'Ù†Ø§Ù…Ø´Ø®Øµ'}
- Ø§Ø³Ú©Ø±ÛŒÙ† ØªØ§ÛŒÙ…: ${userProfile.screenTime || 'Ù†Ø§Ù…Ø´Ø®Øµ'}

Ø§Ø² Ø§ÛŒÙ† Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø±Ø§ÛŒ Ø´Ø®ØµÛŒâ€ŒØ³Ø§Ø²ÛŒ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§Øª Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†. Ú¯Ø§Ù‡ÛŒ Ø§Ø³Ù… Ú©Ø§Ø±Ø¨Ø± Ø±Ùˆ ØµØ¯Ø§ Ø¨Ø²Ù†.
ÛŒØ§Ø¯Øª Ø¨Ø§Ø´Ù‡: ÙÙ‚Ø· ÙØ§Ø±Ø³ÛŒ. Ù‡ÛŒÚ† Ø²Ø¨Ø§Ù† Ø¯ÛŒÚ¯Ù‡â€ŒØ§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù†Ú©Ù†.`
  }

  // Ø³Ø§Ø®Øª ØªØ§Ø±ÛŒØ®Ú†Ù‡
  const messages = [
    { role: 'system', content: systemPrompt },
  ]

  if (history && Array.isArray(history)) {
    const recent = history.slice(-20)
    for (const msg of recent) {
      messages.push({
        role: msg.role === 'assistant' ? 'assistant' : 'user',
        content: msg.content,
      })
    }
  }

  messages.push({ role: 'user', content: message })

  // Ø§Ø±Ø³Ø§Ù„ - ØªØ³Øª Ø¨Ø§ Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù
  const completion = await groqClient.chat.completions.create({
    model: 'llama-3.3-70b-versatile',
    messages: messages,
    temperature: 0.6,
    max_tokens: 400,
    top_p: 0.9,
  })

  return completion.choices[0]?.message?.content || 'Ù…ØªØ£Ø³ÙÙ…ØŒ Ù†ØªÙˆÙ†Ø³ØªÙ… Ø¬ÙˆØ§Ø¨ Ø¨Ø¯Ù….'
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ØªØ§Ø¨Ø¹ Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Gemini
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function sendToGemini(message, history, userProfile) {
  if (!geminiModel) throw new Error('Gemini API Key ØªÙ†Ø¸ÛŒÙ… Ù†Ø´Ø¯Ù‡')

  const geminiHistory = []
  if (history && Array.isArray(history)) {
    const recent = history.slice(-20)
    let foundFirstUser = false
    for (const msg of recent) {
      if (!foundFirstUser && msg.role === 'assistant') continue
      foundFirstUser = true
      geminiHistory.push({
        role: msg.role === 'assistant' ? 'model' : 'user',
        parts: [{ text: msg.content }],
      })
    }
  }

  const chat = geminiModel.startChat({ history: geminiHistory })
  const result = await chat.sendMessage(message)
  return result.response.text()
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// API Routes
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

app.get('/api/health', (req, res) => {
  res.json({
    status: 'ok',
    provider: AI_PROVIDER,
    groq: groqClient ? 'âœ…' : 'âŒ',
    gemini: geminiModel ? 'âœ…' : 'âŒ',
  })
})

app.post('/api/chat', async (req, res) => {
  try {
    const { message, history, userProfile } = req.body

    if (!message || typeof message !== 'string') {
      return res.status(400).json({ error: 'Ù¾ÛŒØ§Ù… Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª' })
    }

    let reply

    if (AI_PROVIDER === 'groq') {
      try {
        reply = await sendToGroq(message, history, userProfile)
      } catch (groqError) {
        console.error('Ø®Ø·Ø§ Ø¯Ø± Groq:', groqError.message)
        if (geminiModel) {
          console.log('Fallback Ø¨Ù‡ Gemini...')
          reply = await sendToGemini(message, history, userProfile)
        } else {
          throw groqError
        }
      }
    } else {
      try {
        reply = await sendToGemini(message, history, userProfile)
      } catch (geminiError) {
        console.error('Ø®Ø·Ø§ Ø¯Ø± Gemini:', geminiError.message)
        if (groqClient) {
          console.log('Fallback Ø¨Ù‡ Groq...')
          reply = await sendToGroq(message, history, userProfile)
        } else {
          throw geminiError
        }
      }
    }

    res.json({ reply })

  } catch (error) {
    console.error('Ø®Ø·Ø§ Ø¯Ø± AI:', error.message)

    if (error.message?.includes('429') || error.message?.includes('quota')) {
      return res.status(429).json({
        error: 'ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ Ø²ÛŒØ§Ø¯ Ø´Ø¯Ù‡. Û³Û° Ø«Ø§Ù†ÛŒÙ‡ ØµØ¨Ø± Ú©Ù†.',
      })
    }

    res.status(500).json({
      error: 'Ù…Ø´Ú©Ù„ÛŒ Ù¾ÛŒØ´ Ø§ÙˆÙ…Ø¯. Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†.',
    })
  }
})

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ø´Ø±ÙˆØ¹ Ø³Ø±ÙˆØ±
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

app.listen(PORT, () => {
  console.log('')
  console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•')
  console.log(`  ğŸš€ MODO Backend running on port ${PORT}`)
  console.log(`  ğŸ“¡ http://localhost:${PORT}`)
  console.log(`  ğŸ¤– AI Provider: ${AI_PROVIDER.toUpperCase()}`)
  console.log(`  ğŸ”‘ Groq:   ${process.env.GROQ_API_KEY ? 'âœ… Loaded' : 'âŒ Missing'}`)
  console.log(`  ğŸ”‘ Gemini: ${process.env.GEMINI_API_KEY ? 'âœ… Loaded' : 'âŒ Missing'}`)
  console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•')
  console.log('')
})